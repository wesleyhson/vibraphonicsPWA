<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/vibraphonicsPWA/sw.js');
  }

  document.addEventListener('DOMContentLoaded', () => {
    const feed = document.getElementById('feed');

    fetch('https://api.github.com/repos/wesleyhson/vibraphonicsPWA/contents/dropzone')
      .then(r => r.json())
      .then(files => {
        const htmlFiles = files
          .filter(f => f.name.endsWith('.html'))
          .map(f => f.name)
          .sort();

        if (htmlFiles.length === 0) {
          feed.innerHTML = '<div style="color:#0f0; text-align:center; padding:20vh; font-family:monospace;">No applets yet!</div>';
          return;
        }

        htmlFiles.forEach(file => {
          const iframe = document.createElement('iframe');
          iframe.src = '/vibraphonicsPWA/dropzone/' + file + '?v=' + Date.now();
          iframe.style = 'width:100%; height:100vh; border:none; display:block; scroll-snap-align:start;';
          iframe.loading = 'lazy';
          iframe.allow = 'autoplay; fullscreen';
          feed.appendChild(iframe);
        });
      })
      .catch(err => {
        feed.innerHTML = '<div style="color:#f00; text-align:center; padding:20vh;">API Error. Check file paths.</div>';
        console.error(err);
      });
  });
</script>